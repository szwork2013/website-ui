angular.module("website.ui",["website.ui.player"]);
angular.module("website.ui.player",[]).controller("MusicPlayerCtrl",["$scope",function(e){e.mode="order";var t=e.currentIndex=0;if(e.volume=100,e.autoplay=!0,e.isPlaying=!0,e.list=function(){return e.list}(),angular.isArray(e.list)&&0!=e.list.length)e.currentMusic=e.list[t];else{var r={};r.url="",r.title="",r.artist="",r.special="",e.currentMusic=r}}]).directive("musicplayer",["$document","MusicPlayerService",function(e,t){function r(e){i=setInterval(function(){a+=2,a>=360&&(a=0),e.style.cssText="-webkit-transform:rotate("+a+"deg);-moz-transform:rotate("+a+"deg);-o-transform:rotate("+a+"deg);transform:rotate("+a+"deg)"},50)}var i,a=0,n=function(a,n){var l=new Audio(a.currentMusic.url);n.append(l);var u=e[0].getElementById("duration"),c=e[0].getElementById("volume"),s=e[0].getElementById("nextSong"),o=e[0].getElementsByName("play"),d=e[0].getElementById("music_img"),v=u.offsetWidth;angular.element(c).on("click",function(e){console.log(e.offsetX),l.volume=e.offsetX/this.offsetWidth,a.$apply(function(){a.volume=Math.round(100*this.volume)}.bind(l))}),angular.element(s).on("click",function(){a.$apply(function(){a.currentMusic=t.getNext(a)})}),a.$watch("currentMusic",function(e){l.src=e.url}),angular.forEach(o,function(e){angular.element(e).on("click",function(){var e=!0;l.paused?(l.play(),r(d),e=!0):(l.pause(),i&&(clearInterval(i),i=null),e=!1),a.$apply(function(){a.isPlaying=e})})});var m=function(){var e=this;a.loaded=!0;var n=this.duration,c=Math.floor(n/60),s=Math.ceil(n-60*c);"number"==typeof a.volume&&(this.volume=a.volume/100),a.$apply(function(){"number"!=typeof a.volume&&(a.volume=Math.round(100*Math.random()))}.bind(this)),angular.element(u).on("click",function(t){console.log(t.offsetX);var r=Math.ceil(t.offsetX/v*100),i=n*(t.offsetX/v);e.currentTime=i,a.$apply(function(){a.currentMusic.currentPlayDuration=r})});var o=function(){var e=this.currentTime,t=Math.floor(e/60),r=Math.ceil(e-60*t);60==r&&(t++,r=0);var i=t+":"+(10>r?"0"+r:r),n=this.duration,l=Math.ceil(e/n*100);setTimeout(function(){a.$apply(function(){a.currentMusic.currentPlayDuration=l,a.currentMusic.time=i})},0)};l.addEventListener("timeupdate",o,!0);var m=!0;a.autoplay?(l.play(),m=!0,i||r(d)):m=!1,a.$apply(function(){a.isPlaying=m}),l.addEventListener("ended",function(){a.$apply(function(){a.currentMusic=t.getNext(a)})},!0)};l.addEventListener("canplaythrough",m,!0)};return{restrict:"E",scope:{list:"="},controller:"MusicPlayerCtrl",compile:function(){return n},templateUrl:"template/musicplayer.html",replace:!0}}]).factory("MusicPlayerService",function(){return{getNext:function(e){var t=e.list,r=e.mode;if(!angular.isArray(t)||0==t.length)return null;if(1==t.length)return t[0];var i=t.length;switch(r.toLowerCase().trim()){case"random":e.currentIndex=Math.ceil(Math.random()*i)-1;break;case"order":e.currentIndex++,e.currentIndex>=i&&(e.currentIndex=0)}return t[e.currentIndex]}}}).run(["$templateCache",function(e){e.put("template/musicplayer.html",'<div class="container" ><div class="player-panel"><div class="row"><div class="col-md-4"><div class="music-img" id = "music_img"></div><div ng-class="isPlaying ? \'pause-ab ctrl\' : \'play-ab ctrl\'" name="play"></div></div><div class="col-md-8"><div class="">标题:{{currentMusic.title}}</div><div><div class=" ">歌手:{{currentMusic.artist}}</div><div class=" ">专辑:{{currentMusic.special}}</div></div><div><div class="progress duration" id="duration"><div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100" style="width: {{currentMusic.currentPlayDuration}}%"></div></div><div style="float: left;margin-left:5px;">{{currentMusic.time}}</div><ul style="clear:both;"><li ng-class="isPlaying ? \'pause ctrl\' : \'play ctrl\'" name="play"></li><li class="ctrl next" id="nextSong"></li><li class="ctrl ctrl-sm volume"></li><li><div class="progress volume-bar" id="volume"><div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100" style="width: {{volume}}%"></div></div></li><li style="margin-top: 6px;margin-left: 5px;">{{volume}}%</li></ul></div></div></div></div></div>')}]);